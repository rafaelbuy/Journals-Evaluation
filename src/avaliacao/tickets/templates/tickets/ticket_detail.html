{% extends "base.html" %}
{% load i18n %}
{% block body_title %}Ingress History{% endblock %}

{% block stepmenu_top %}
    {{ block.super }}
        / <a href="{% url ticket.user_index %}">{% trans 'Ingress' %}</a>
    / {% trans 'About Ingress' %}   #{{ object.pk }}
{% endblock %}

{% block body %}

<fieldset>
    <legend>{% trans "Current Situation" %}</legend>
    {% if object %}
        <table class="table">
            <tr>
                <th>{% trans "Creation date" %}</th>
                <th>{% trans "Context" %}</th>
                <th>{% trans "Type" %}</th>
                <th>{% trans "Subject" %}</th>
                <th>{% trans "Status" %}</th>
                <th>{% trans "Last update" %}</th>
                <!--th>{% trans "Mark as" %}</th-->
            </tr>
            <tr>
                <td>{{ object.created }}</td>
                <td>{{ object.context }}</td>
                <td>{{ object.type }}</td>
                <td>{{ object.followup_set.latest.subject }}</td>
                <td>{{ object.followup_set.latest.status }}</td>
                <td>{{ object.followup_set.latest.iteration_date }}</td>
                <!--td>
                    <ul>
                        {% if object.is_closed or object.is_resolved %}
                        <li><a href="/ticket/reopen/{{ object.pk }}/">{% trans "reopen" %}</a></li>
                        {% endif %}
                        {% if not object.is_closed %} {% if not object.is_resolved %}
                        <li><a href="/ticket/resolve/{{ object.pk }}/">{% trans "resolved" %}</a></li>
                        {% endif %} {% endif %}
                        {% if not object.is_closed %} {% if not object.is_resolved %}
                        <li><a href="/ticket/close/{{ object.pk }}/">{% trans "closed" %}</a></li>
                        {% endif %} {% endif %}
                    </ul>
                </td-->
            </tr>
        </table>
    {% else %}
    <p>{% trans "Ticket not found" %}.</p>
    {% endif %}
</fieldset>

<fieldset>
    <legend>{% trans "History" %}</legend>
    {% if object.followup_set.all %}
    <table class="table">
        <tr>
            <th>{% trans "Update date" %}</th>
            <th>{% trans "Status" %}</th>
            <th width="40%">{% trans "Description" %}</th>
            <th>{% trans "Assigned to" %}</th>
            <th>{% trans "Files" %}</th>
        </tr>
        {% for fw in object.followup_set.all %}
        <tr>
            <td>{{ fw.iteration_date }}</td>
            <td>{{ fw.status }}</td>
            <td width="40%" style="text-align: justify;">{{ fw.description }}</td>
            <td>{{ fw.to_user }}</td>
                <td>
                {% for med in fw.ticket_media.all %}
                    <a href="/static/{{ med.file }}">{{med.file}}</a><br/>
                {% endfor %}
                </td>
        </tr>
        {% endfor %}
    </table>
    {% endif %}
</fieldset>
{% if object.is_closed or object.is_resolved %} <p>{% trans 'To show the "add iteration button" the ticket must be diferente from "closed".' %}</p> {% else %} <a class="buttonadd" href="/ticket/newiteration/{{ object.pk }}/">Add Iteration</a> {% endif %}
{% endblock %}
